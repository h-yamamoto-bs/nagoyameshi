{% extends 'base.html' %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    
    <!-- =================================== -->
    <!-- Ê§úÁ¥¢ÁµêÊûú„Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜ -->
    <!-- =================================== -->
    <div style="margin-bottom: 30px;">
        <!-- „Éë„É≥„Åè„Åö„É™„Çπ„Éà -->
        <nav style="margin-bottom: 15px;">
            <span style="color: #666;">
                <a href="{% url 'shops:shop_list' %}" style="color: #007bff; text-decoration: none;">„Éõ„Éº„É†</a>
                <span> &gt; </span>
                <span>Ê§úÁ¥¢ÁµêÊûú</span>
            </span>
        </nav>
        
        <!-- Ê§úÁ¥¢ÁµêÊûú„ÅÆ„Çø„Ç§„Éà„É´„Å®‰ª∂Êï∞ -->
        <div style="border-bottom: 2px solid #007bff; padding-bottom: 10px;">
            {% if query %}
                <h1 style="margin: 0; font-size: 24px; color: #333;">
                    „Äå{{ query }}„Äç„ÅÆÊ§úÁ¥¢ÁµêÊûú
                </h1>
                <p style="margin: 10px 0 0 0; color: #666; font-size: 16px;">
                    {{ result_count }}‰ª∂„ÅÆÂ∫óËàó„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü
                </p>
            {% else %}
                <h1 style="margin: 0; font-size: 24px; color: #333;">
                    Ê§úÁ¥¢ÁµêÊûú
                </h1>
                <p style="margin: 10px 0 0 0; color: #666; font-size: 16px;">
                    Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </p>
            {% endif %}
        </div>
    </div>

    <!-- =================================== -->
    <!-- Ê§úÁ¥¢ÁµêÊûú‰∏ÄË¶ßË°®Á§∫ÈÉ®ÂàÜ -->
    <!-- =================================== -->
    {% if shops %}
        <!-- Ê§úÁ¥¢ÁµêÊûú„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆË°®Á§∫ -->
        <div style="margin-bottom: 30px;">
            {% for shop in shops %}
                <a href="{% url 'shops:shop_detail' shop.pk %}" 
                   style="text-decoration: none; color: inherit; display: block; margin-bottom: 20px;">
                    
                    <!-- ÂêÑÂ∫óËàó„ÅÆ„Ç´„Éº„Éâ -->
                    <div class="shop-card" 
                         style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; 
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.3s ease; 
                                display: flex; align-items: flex-start; cursor: pointer;"
                         onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; this.style.transform='translateY(-2px)'"
                         onmouseout="this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
                        
                        <!-- Â∫óËàóÁîªÂÉè„Ç®„É™„Ç¢ -->
                        <div class="shop-images" style="margin-right: 20px; flex-shrink: 0;">
                            {% if shop.images.exists %}
                                <!-- ÁîªÂÉè„Åå„ÅÇ„ÇãÂ†¥ÂêàÔºöÊúÄÂ§ß3ÊûöË°®Á§∫ -->
                                <div style="display: flex; gap: 8px; width: 260px; height: 90px;">
                                    {% for image in shop.images.all|slice:":3" %}
                                        <img src="{{ image.image.url }}"
                                             alt="{{ shop.name }} - ÁîªÂÉè{{ forloop.counter }}"
                                             style="width: 80px; height: 90px; object-fit: cover; 
                                                    border-radius: 6px; flex-shrink: 0; 
                                                    border: 1px solid #eee;">
                                    {% endfor %}
                                    
                                    <!-- 4Êûö‰ª•‰∏ä„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Äå+N„ÄçË°®Á§∫ -->
                                    {% if shop.images.count > 3 %}
                                        <div style="width: 80px; height: 90px; background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(0,0,0,0.9)); 
                                                    border-radius: 6px; display: flex; align-items: center; justify-content: center; 
                                                    color: white; font-weight: bold; font-size: 16px;">
                                            +{{ shop.images.count|add:"-3" }}
                                        </div>
                                    {% endif %}
                                </div>
                            {% else %}
                                <!-- ÁîªÂÉè„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº -->
                                <div style="width: 90px; height: 90px; background: linear-gradient(135deg, #f0f0f0, #e0e0e0); 
                                            border-radius: 6px; display: flex; align-items: center; justify-content: center; 
                                            color: #999; border: 1px solid #ddd;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 24px; margin-bottom: 5px;">üì∑</div>
                                        <div style="font-size: 10px;">ÁîªÂÉè„Å™„Åó</div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Â∫óËàóÊÉÖÂ†±„Ç®„É™„Ç¢ -->
                        <div class="shop-info" style="flex-grow: 1; min-width: 0;">
                            <!-- Â∫óËàóÂêç -->
                            <h2 style="margin: 0 0 15px 0; font-size: 20px; color: #333; 
                                       font-weight: bold; line-height: 1.3;">
                                {{ shop.name }}
                            </h2>
                            
                            <!-- Â∫óËàóË©≥Á¥∞ÊÉÖÂ†± -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px 20px; 
                                        margin-bottom: 10px;">
                                <!-- ‰ΩèÊâÄ -->
                                <p style="margin: 0; color: #666; font-size: 14px; 
                                          display: flex; align-items: center;">
                                    <span style="font-weight: bold; color: #007bff; margin-right: 8px;">üìç</span>
                                    <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                        {{ shop.address }}
                                    </span>
                                </p>
                                
                                <!-- ÈõªË©±Áï™Âè∑ -->
                                <p style="margin: 0; color: #666; font-size: 14px; 
                                          display: flex; align-items: center;">
                                    <span style="font-weight: bold; color: #28a745; margin-right: 8px;">üìû</span>
                                    <span>{{ shop.phone_number|default:"ÈõªË©±Áï™Âè∑Êú™ÁôªÈå≤" }}</span>
                                </p>
                                
                                <!-- Â∏≠Êï∞ -->
                                <p style="margin: 0; color: #666; font-size: 14px; 
                                          display: flex; align-items: center;">
                                    <span style="font-weight: bold; color: #ffc107; margin-right: 8px;">ü™ë</span>
                                    <span>{{ shop.seat_count }}Â∏≠</span>
                                </p>
                                
                                <!-- ÁîªÂÉèÊûöÊï∞ÔºàÁîªÂÉè„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøÔºâ -->
                                {% if shop.images.count > 0 %}
                                <p style="margin: 0; color: #999; font-size: 12px; 
                                          display: flex; align-items: center;">
                                    <span style="margin-right: 8px;">üì∑</span>
                                    <span>{{ shop.images.count }}Êûö„ÅÆÂÜôÁúü</span>
                                </p>
                                {% endif %}
                            </div>
                            
                            <!-- Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„Éè„Ç§„É©„Ç§„ÉàÁî®„ÅÆË™¨ÊòéÔºàÂ∞ÜÊù•ÁöÑ„Å™Êã°ÂºµÁî®Ôºâ -->
                            {% comment %}
                            <div style="margin-top: 10px; padding: 8px; background: #f8f9fa; 
                                        border-radius: 4px; font-size: 12px; color: #666;">
                                Ê§úÁ¥¢Êù°‰ª∂„Å´„Éû„ÉÉ„ÉÅ: {{ shop.name }}
                            </div>
                            {% endcomment %}
                        </div>
                    </div>
                </a>
            {% endfor %}
        </div>

        <!-- =================================== -->
        <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ÈÉ®ÂàÜ -->
        <!-- =================================== -->
        {% if is_paginated %}
            <div style="margin-top: 40px; text-align: center;">
                <nav style="display: inline-block; background: white; border-radius: 8px; 
                           box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 10px;">
                    
                    <!-- Ââç„ÅÆ„Éö„Éº„Ç∏„Å∏„ÅÆ„É™„É≥„ÇØ -->
                    {% if page_obj.has_previous %}
                        <a href="?q={{ query }}&page=1" 
                           style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                  text-decoration: none; color: #007bff; border-radius: 4px; 
                                  border: 1px solid #dee2e6;">
                            &laquo; ÊúÄÂàù
                        </a>
                        <a href="?q={{ query }}&page={{ page_obj.previous_page_number }}" 
                           style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                  text-decoration: none; color: #007bff; border-radius: 4px; 
                                  border: 1px solid #dee2e6;">
                            Ââç„Å∏
                        </a>
                    {% endif %}

                    <!-- ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏ÊÉÖÂ†± -->
                    <span style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                 background: #007bff; color: white; border-radius: 4px; 
                                 font-weight: bold;">
                        {{ page_obj.number }}
                    </span>
                    
                    <span style="margin: 0 8px; color: #666;">
                        / {{ page_obj.paginator.num_pages }}
                    </span>

                    <!-- Ê¨°„ÅÆ„Éö„Éº„Ç∏„Å∏„ÅÆ„É™„É≥„ÇØ -->
                    {% if page_obj.has_next %}
                        <a href="?q={{ query }}&page={{ page_obj.next_page_number }}" 
                           style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                  text-decoration: none; color: #007bff; border-radius: 4px; 
                                  border: 1px solid #dee2e6;">
                            Ê¨°„Å∏
                        </a>
                        <a href="?q={{ query }}&page={{ page_obj.paginator.num_pages }}" 
                           style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                  text-decoration: none; color: #007bff; border-radius: 4px; 
                                  border: 1px solid #dee2e6;">
                            ÊúÄÂæå &raquo;
                        </a>
                    {% endif %}
                </nav>
                
                <!-- „Éö„Éº„Ç∏ÊÉÖÂ†±„ÅÆË©≥Á¥∞ -->
                <p style="margin-top: 15px; color: #666; font-size: 14px;">
                    {{ page_obj.start_index }}„Äú{{ page_obj.end_index }}‰ª∂„ÇíË°®Á§∫ 
                    ÔºàÂÖ®{{ result_count }}‰ª∂‰∏≠Ôºâ
                </p>
            </div>
        {% endif %}

    {% else %}
        <!-- =================================== -->
        <!-- Ê§úÁ¥¢ÁµêÊûú„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆË°®Á§∫ -->
        <!-- =================================== -->
        <div style="text-align: center; padding: 60px 20px; background: white; 
                    border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            {% if query %}
                <!-- Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÅåÂÖ•Âäõ„Åï„Çå„Å¶„ÅÑ„Çã„ÅåÁµêÊûú„Åå„Å™„ÅÑÂ†¥Âêà -->
                <div style="font-size: 64px; margin-bottom: 20px; color: #ddd;">üîç</div>
                <h2 style="margin: 0 0 15px 0; color: #666; font-size: 20px;">
                    Ê§úÁ¥¢ÁµêÊûú„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü
                </h2>
                <p style="margin: 0 0 25px 0; color: #999; font-size: 16px;">
                    „Äå<strong style="color: #007bff;">{{ query }}</strong>„Äç„Å´‰∏ÄËá¥„Åô„ÇãÂ∫óËàó„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü
                </p>
                
                <!-- Ê§úÁ¥¢„ÅÆ„Éí„É≥„Éà -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; 
                           margin: 20px auto; max-width: 500px; text-align: left;">
                    <h3 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">
                        Ê§úÁ¥¢„ÅÆ„Ç≥„ÉÑ:
                    </h3>
                    <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
                        <li>„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÁü≠„Åè„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ</li>
                        <li>„Å≤„Çâ„Åå„Å™„Éª„Ç´„Çø„Ç´„Éä„ÉªÊº¢Â≠ó„ÇíÂ§â„Åà„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ</li>
                        <li>Âú∞ÂüüÂêç„ÇÑÈßÖÂêç„ÅßÊ§úÁ¥¢„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ</li>
                        <li>ÈõªË©±Áï™Âè∑„ÅßÊ§úÁ¥¢„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô</li>
                    </ul>
                </div>
                
                <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                <div style="margin-top: 30px;">
                    <a href="{% url 'shops:shop_list' %}" 
                       style="display: inline-block; padding: 12px 24px; background: #007bff; 
                              color: white; text-decoration: none; border-radius: 6px; 
                              font-weight: bold; margin-right: 10px;">
                        ÂÖ®Â∫óËàó„ÇíË¶ã„Çã
                    </a>
                    <button onclick="document.getElementById('search-input').focus()" 
                            style="display: inline-block; padding: 12px 24px; background: white; 
                                   color: #007bff; border: 2px solid #007bff; border-radius: 6px; 
                                   font-weight: bold; cursor: pointer;">
                        ÂÜçÊ§úÁ¥¢„Åô„Çã
                    </button>
                </div>
            {% else %}
                <!-- Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÅåÂÖ•Âäõ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà -->
                <div style="font-size: 64px; margin-bottom: 20px; color: #ddd;">üìù</div>
                <h2 style="margin: 0 0 15px 0; color: #666; font-size: 20px;">
                    Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </h2>
                <p style="margin: 0 0 25px 0; color: #999; font-size: 16px;">
                    Â∫óËàóÂêç„ÄÅ‰ΩèÊâÄ„ÄÅÈõªË©±Áï™Âè∑„ÅßÊ§úÁ¥¢„Åß„Åç„Åæ„Åô
                </p>
                <a href="{% url 'shops:shop_list' %}" 
                   style="display: inline-block; padding: 12px 24px; background: #007bff; 
                          color: white; text-decoration: none; border-radius: 6px; 
                          font-weight: bold;">
                    ÂÖ®Â∫óËàó„ÇíË¶ã„Çã
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- =================================== -->
<!-- ËøΩÂä†„ÅÆ„Çπ„Çø„Ç§„É´„Å®JavaScript -->
<!-- =================================== -->
<style>
/* „Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„ÉàÁî®„ÅÆCSS */
.shop-card:hover {
    border-color: #007bff !important;
}

.shop-card:hover .shop-info h2 {
    color: #007bff !important;
}

/* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
@media (max-width: 768px) {
    .shop-card {
        flex-direction: column !important;
        align-items: stretch !important;
    }
    
    .shop-images {
        margin-right: 0 !important;
        margin-bottom: 15px !important;
        align-self: center;
    }
    
    .shop-info {
        text-align: center;
    }
}
</style>

<script>
// Ê§úÁ¥¢ÁµêÊûú„Éö„Éº„Ç∏Áî®„ÅÆJavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Ê§úÁ¥¢ÁµêÊûú„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅÊ§úÁ¥¢„Éú„ÉÉ„ÇØ„Çπ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÂΩì„Å¶„Å™„ÅÑ
    // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆ„Çπ„ÇØ„É≠„Éº„É´‰ΩçÁΩÆ„ÇíË™øÊï¥
    {% if not shops and query %}
        // Ê§úÁ¥¢ÁµêÊûú„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÊ§úÁ¥¢„Éú„ÉÉ„ÇØ„Çπ„Å´„Éï„Ç©„Éº„Ç´„Çπ
        setTimeout(function() {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.focus();
                searchInput.select(); // „ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ®ÈÅ∏Êäû
            }
        }, 100);
    {% endif %}
});

// Ê§úÁ¥¢ÁµêÊûú„ÅÆ„Éè„Ç§„É©„Ç§„ÉàÊ©üËÉΩÔºàÂ∞ÜÊù•ÁöÑ„Å™Êã°ÂºµÁî®Ôºâ
function highlightSearchTerm(text, term) {
    if (!term) return text;
    const regex = new RegExp(`(${term})`, 'gi');
    return text.replace(regex, '<mark style="background: #fff3cd; padding: 0 2px;">$1</mark>');
}
</script>
{% endblock %}