{% extends 'base.html' %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    
    <!-- =================================== -->
    <!-- æ¤œç´¢çµæœãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† -->
    <!-- =================================== -->
    <div style="margin-bottom: 30px;">
        <!-- ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ -->
        <nav style="margin-bottom: 15px;">
            <span style="color: #666;">
                <a href="{% url 'shops:shop_list' %}" style="color: #007bff; text-decoration: none;">ãƒ›ãƒ¼ãƒ </a>
                <span> &gt; </span>
                <span>æ¤œç´¢çµæœ</span>
            </span>
        </nav>
        
        <!-- æ¤œç´¢çµæœã®ã‚¿ã‚¤ãƒˆãƒ«ã¨ä»¶æ•° -->
        <div style="border-bottom: 2px solid #007bff; padding-bottom: 10px;">
            {% if query %}
                <h1 style="margin: 0; font-size: 24px; color: #333;">
                    ã€Œ{{ query }}ã€ã®æ¤œç´¢çµæœ
                </h1>
                <p style="margin: 10px 0 0 0; color: #666; font-size: 16px;">
                    {{ result_count }}ä»¶ã®åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ
                </p>
            {% else %}
                <h1 style="margin: 0; font-size: 24px; color: #333;">
                    æ¤œç´¢çµæœ
                </h1>
                <p style="margin: 10px 0 0 0; color: #666; font-size: 16px;">
                    æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                </p>
            {% endif %}
        </div>
    </div>

    <!-- =================================== -->
    <!-- æ¤œç´¢çµæœä¸€è¦§è¡¨ç¤ºéƒ¨åˆ† -->
    <!-- =================================== -->
    {% if shops %}
        <!-- æ¤œç´¢çµæœãŒã‚ã‚‹å ´åˆã®è¡¨ç¤º -->
        <div style="margin-bottom: 30px;">
            {% for shop in shops %}
                <a href="{% url 'shops:shop_detail' shop.pk %}" 
                   style="text-decoration: none; color: inherit; display: block; margin-bottom: 20px;">
                    
                    <!-- å„åº—èˆ—ã®ã‚«ãƒ¼ãƒ‰ -->
                    <div class="shop-card" 
                         style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; 
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.3s ease; 
                                display: flex; align-items: flex-start; cursor: pointer;"
                         onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; this.style.transform='translateY(-2px)'"
                         onmouseout="this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
                        
                        <!-- åº—èˆ—ç”»åƒã‚¨ãƒªã‚¢ -->
                        <div class="shop-images" style="margin-right: 20px; flex-shrink: 0;">
                            {% if shop.images.exists %}
                                <!-- ç”»åƒãŒã‚ã‚‹å ´åˆï¼šæœ€å¤§3æšè¡¨ç¤º -->
                                <div style="display: flex; gap: 8px; width: 260px; height: 90px;">
                                    {% for image in shop.images.all|slice:":3" %}
                                        <img src="{{ image.image.url }}"
                                             alt="{{ shop.name }} - ç”»åƒ{{ forloop.counter }}"
                                             style="width: 80px; height: 90px; object-fit: cover; 
                                                    border-radius: 6px; flex-shrink: 0; 
                                                    border: 1px solid #eee;">
                                    {% endfor %}
                                    
                                    <!-- 4æšä»¥ä¸Šã‚ã‚‹å ´åˆã®ã€Œ+Nã€è¡¨ç¤º -->
                                    {% if shop.images.count > 3 %}
                                        <div style="width: 80px; height: 90px; background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(0,0,0,0.9)); 
                                                    border-radius: 6px; display: flex; align-items: center; justify-content: center; 
                                                    color: white; font-weight: bold; font-size: 16px;">
                                            +{{ shop.images.count|add:"-3" }}
                                        </div>
                                    {% endif %}
                                </div>
                            {% else %}
                                <!-- ç”»åƒãŒãªã„å ´åˆã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ -->
                                <div style="width: 90px; height: 90px; background: linear-gradient(135deg, #f0f0f0, #e0e0e0); 
                                            border-radius: 6px; display: flex; align-items: center; justify-content: center; 
                                            color: #999; border: 1px solid #ddd;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“·</div>
                                        <div style="font-size: 10px;">ç”»åƒãªã—</div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>

                        <!-- åº—èˆ—æƒ…å ±ã‚¨ãƒªã‚¢ -->
                        <div class="shop-info" style="flex-grow: 1; min-width: 0;">
                            <!-- åº—èˆ—å -->
                            <h2 style="margin: 0 0 15px 0; font-size: 20px; color: #333; 
                                       font-weight: bold; line-height: 1.3;">
                                {{ shop.name }}
                            </h2>
                            
                            <!-- åº—èˆ—è©³ç´°æƒ…å ± -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px 20px; 
                                        margin-bottom: 10px;">
                                <!-- ä½æ‰€ -->
                                <p style="margin: 0; color: #666; font-size: 14px; 
                                          display: flex; align-items: center;">
                                    <span style="font-weight: bold; color: #007bff; margin-right: 8px;">ğŸ“</span>
                                    <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                        {{ shop.address }}
                                    </span>
                                </p>
                                
                                <!-- é›»è©±ç•ªå· -->
                                <p style="margin: 0; color: #666; font-size: 14px; 
                                          display: flex; align-items: center;">
                                    <span style="font-weight: bold; color: #28a745; margin-right: 8px;">ğŸ“</span>
                                    <span>{{ shop.phone_number|default:"é›»è©±ç•ªå·æœªç™»éŒ²" }}</span>
                                </p>
                                
                                <!-- å¸­æ•° -->
                                <p style="margin: 0; color: #666; font-size: 14px; 
                                          display: flex; align-items: center;">
                                    <span style="font-weight: bold; color: #ffc107; margin-right: 8px;">ğŸª‘</span>
                                    <span>{{ shop.seat_count }}å¸­</span>
                                </p>
                                
                                <!-- ç”»åƒæšæ•°ï¼ˆç”»åƒãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰ -->
                                {% if shop.images.count > 0 %}
                                <p style="margin: 0; color: #999; font-size: 12px; 
                                          display: flex; align-items: center;">
                                    <span style="margin-right: 8px;">ğŸ“·</span>
                                    <span>{{ shop.images.count }}æšã®å†™çœŸ</span>
                                </p>
                                {% endif %}
                            </div>
                            
                            <!-- æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆç”¨ã®èª¬æ˜ï¼ˆå°†æ¥çš„ãªæ‹¡å¼µç”¨ï¼‰ -->
                            {% comment %}
                            <div style="margin-top: 10px; padding: 8px; background: #f8f9fa; 
                                        border-radius: 4px; font-size: 12px; color: #666;">
                                æ¤œç´¢æ¡ä»¶ã«ãƒãƒƒãƒ: {{ shop.name }}
                            </div>
                            {% endcomment %}
                        </div>
                    </div>
                </a>
            {% endfor %}
        </div>

        <!-- =================================== -->
        <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³éƒ¨åˆ† -->
        <!-- =================================== -->
        {% if is_paginated %}
            <div style="margin-top: 40px; text-align: center;">
                <nav style="display: inline-block; background: white; border-radius: 8px; 
                           box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 10px;">
                    
                    <!-- å‰ã®ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ -->
                    {% if page_obj.has_previous %}
                        <a href="?q={{ query }}&page=1" 
                           style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                  text-decoration: none; color: #007bff; border-radius: 4px; 
                                  border: 1px solid #dee2e6;">
                            &laquo; æœ€åˆ
                        </a>
                        <a href="?q={{ query }}&page={{ page_obj.previous_page_number }}" 
                           style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                  text-decoration: none; color: #007bff; border-radius: 4px; 
                                  border: 1px solid #dee2e6;">
                            å‰ã¸
                        </a>
                    {% endif %}

                    <!-- ç¾åœ¨ã®ãƒšãƒ¼ã‚¸æƒ…å ± -->
                    <span style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                 background: #007bff; color: white; border-radius: 4px; 
                                 font-weight: bold;">
                        {{ page_obj.number }}
                    </span>
                    
                    <span style="margin: 0 8px; color: #666;">
                        / {{ page_obj.paginator.num_pages }}
                    </span>

                    <!-- æ¬¡ã®ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ -->
                    {% if page_obj.has_next %}
                        <a href="?q={{ query }}&page={{ page_obj.next_page_number }}" 
                           style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                  text-decoration: none; color: #007bff; border-radius: 4px; 
                                  border: 1px solid #dee2e6;">
                            æ¬¡ã¸
                        </a>
                        <a href="?q={{ query }}&page={{ page_obj.paginator.num_pages }}" 
                           style="display: inline-block; padding: 8px 12px; margin: 0 2px; 
                                  text-decoration: none; color: #007bff; border-radius: 4px; 
                                  border: 1px solid #dee2e6;">
                            æœ€å¾Œ &raquo;
                        </a>
                    {% endif %}
                </nav>
                
                <!-- ãƒšãƒ¼ã‚¸æƒ…å ±ã®è©³ç´° -->
                <p style="margin-top: 15px; color: #666; font-size: 14px;">
                    {{ page_obj.start_index }}ã€œ{{ page_obj.end_index }}ä»¶ã‚’è¡¨ç¤º 
                    ï¼ˆå…¨{{ result_count }}ä»¶ä¸­ï¼‰
                </p>
            </div>
        {% endif %}

    {% else %}
        <!-- =================================== -->
        <!-- æ¤œç´¢çµæœãŒãªã„å ´åˆã®è¡¨ç¤º -->
        <!-- =================================== -->
        <div style="text-align: center; padding: 60px 20px; background: white; 
                    border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            {% if query %}
                <!-- æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ãŒçµæœãŒãªã„å ´åˆ -->
                <div style="font-size: 64px; margin-bottom: 20px; color: #ddd;">ğŸ”</div>
                <h2 style="margin: 0 0 15px 0; color: #666; font-size: 20px;">
                    æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ
                </h2>
                <p style="margin: 0 0 25px 0; color: #999; font-size: 16px;">
                    ã€Œ<strong style="color: #007bff;">{{ query }}</strong>ã€ã«ä¸€è‡´ã™ã‚‹åº—èˆ—ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ
                </p>
                
                <!-- æ¤œç´¢ã®ãƒ’ãƒ³ãƒˆ -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; 
                           margin: 20px auto; max-width: 500px; text-align: left;">
                    <h3 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">
                        æ¤œç´¢ã®ã‚³ãƒ„:
                    </h3>
                    <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
                        <li>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’çŸ­ãã—ã¦ã¿ã¦ãã ã•ã„</li>
                        <li>ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠãƒ»æ¼¢å­—ã‚’å¤‰ãˆã¦ã¿ã¦ãã ã•ã„</li>
                        <li>åœ°åŸŸåã‚„é§…åã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„</li>
                        <li>é›»è©±ç•ªå·ã§æ¤œç´¢ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™</li>
                    </ul>
                </div>
                
                <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                <div style="margin-top: 30px;">
                    <a href="{% url 'shops:shop_list' %}" 
                       style="display: inline-block; padding: 12px 24px; background: #007bff; 
                              color: white; text-decoration: none; border-radius: 6px; 
                              font-weight: bold; margin-right: 10px;">
                        å…¨åº—èˆ—ã‚’è¦‹ã‚‹
                    </a>
                    <button onclick="document.getElementById('search-input').focus()" 
                            style="display: inline-block; padding: 12px 24px; background: white; 
                                   color: #007bff; border: 2px solid #007bff; border-radius: 6px; 
                                   font-weight: bold; cursor: pointer;">
                        å†æ¤œç´¢ã™ã‚‹
                    </button>
                </div>
            {% else %}
                <!-- æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ãªã„å ´åˆ -->
                <div style="font-size: 64px; margin-bottom: 20px; color: #ddd;">ğŸ“</div>
                <h2 style="margin: 0 0 15px 0; color: #666; font-size: 20px;">
                    æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                </h2>
                <p style="margin: 0 0 25px 0; color: #999; font-size: 16px;">
                    åº—èˆ—åã€ä½æ‰€ã€é›»è©±ç•ªå·ã§æ¤œç´¢ã§ãã¾ã™
                </p>
                <a href="{% url 'shops:shop_list' %}" 
                   style="display: inline-block; padding: 12px 24px; background: #007bff; 
                          color: white; text-decoration: none; border-radius: 6px; 
                          font-weight: bold;">
                    å…¨åº—èˆ—ã‚’è¦‹ã‚‹
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- =================================== -->
<!-- è¿½åŠ ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¨JavaScript -->
<!-- =================================== -->
<style>
/* ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ã®CSS */
.shop-card:hover {
    border-color: #007bff !important;
}

.shop-card:hover .shop-info h2 {
    color: #007bff !important;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
    .shop-card {
        flex-direction: column !important;
        align-items: stretch !important;
    }
    
    .shop-images {
        margin-right: 0 !important;
        margin-bottom: 15px !important;
        align-self: center;
    }
    
    .shop-info {
        text-align: center;
    }
}
</style>

<script>
// æ¤œç´¢çµæœãƒšãƒ¼ã‚¸ç”¨ã®JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // æ¤œç´¢çµæœãŒã‚ã‚‹å ´åˆã€æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å½“ã¦ãªã„
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’èª¿æ•´
    {% if not shops and query %}
        // æ¤œç´¢çµæœãŒãªã„å ´åˆã¯æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
        setTimeout(function() {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.focus();
                searchInput.select(); // ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¨é¸æŠ
            }
        }, 100);
    {% endif %}
});

// æ¤œç´¢çµæœã®ãƒã‚¤ãƒ©ã‚¤ãƒˆæ©Ÿèƒ½ï¼ˆå°†æ¥çš„ãªæ‹¡å¼µç”¨ï¼‰
function highlightSearchTerm(text, term) {
    if (!term) return text;
    const regex = new RegExp(`(${term})`, 'gi');
    return text.replace(regex, '<mark style="background: #fff3cd; padding: 0 2px;">$1</mark>');
}
</script>
{% endblock %}