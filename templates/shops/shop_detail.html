{% extends 'base.html' %}

{% block content %}
<div>
    <!-- ãƒ‘ãƒ³ã‚¯ã‚ºãƒªã‚¹ãƒˆ -->
    <div>
        <nav>
            <span> &gt; </span>
            <a href="{% url 'shops:shop_list' %}">ãƒ›ãƒ¼ãƒ </a>
            <span> &gt; </span>
            <span>{{ shop.name }}</span>
        </nav>
    </div>

    <!-- ç”»åƒã‚«ãƒ«ãƒ¼ã‚»ãƒ«éƒ¨åˆ† -->
    {% if shop.images.exists %}
        <div class="image-carousel" style="position: relative; margin: 20px 0; max-width: 600px; margin: 20px auto;">
            <!-- ç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="carousel-container" style="position: relative; width: 100%; height: 400px; overflow: hidden; border-radius: 10px; background: #f0f0f0;">
                <div class="carousel-track" id="carouselTrack" style="display: flex; width: {{ shop.images.count }}00%; height: 100%; transition: transform 0.3s ease;">
                    {% for image in shop.images.all %}
                        <div class="carousel-slide" style="width: calc(100% / {{ shop.images.count }}); flex-shrink: 0;">
                            <img src="{{ image.image.url }}"
                                 alt="{{ shop.name }} - ç”»åƒ{{ forloop.counter }}"
                                 style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                    {% endfor %}
                </div>

                <!-- å·¦å³ã®çŸ¢å°ãƒœã‚¿ãƒ³ -->
                {% if shop.images.count > 1 %}
                    <button class="carousel-btn prev-btn" onclick="moveSlide(-1)"
                            style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
                                   background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%;
                                   width: 50px; height: 50px; cursor: pointer; font-size: 20px; z-index: 10;">
                        â€¹
                    </button>
                    <button class="carousel-btn next-btn" onclick="moveSlide(1)"
                            style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
                                   background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%;
                                   width: 50px; height: 50px; cursor: pointer; font-size: 20px; z-index: 10;">
                        â€º
                    </button>
                {% endif %}

                <!-- ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ï¼ˆãƒ‰ãƒƒãƒˆï¼‰ -->
                {% if shop.images.count > 1 %}
                    <div class="carousel-indicators" style="position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; z-index: 10;">
                        {% for image in shop.images.all %}
                            <button class="indicator-dot" onclick="goToSlide({{ forloop.counter0 }})"
                                    style="width: 12px; height: 12px; border-radius: 50%; border: 2px solid white;
                                           background: {% if forloop.first %}white{% else %}transparent{% endif %};
                                           cursor: pointer; transition: background 0.3s ease;">
                            </button>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- ç”»åƒã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ -->
            {% if shop.images.count > 1 %}
                <div class="image-counter" style="text-align: center; margin-top: 10px; color: #666; font-size: 14px;">
                    <span id="currentSlide">1</span> / {{ shop.images.count }}
                </div>
            {% endif %}
        </div>
    {% else %}
        <!-- ç”»åƒãŒãªã„å ´åˆ -->
        <div style="width: 100%; height: 300px; background-color: #f0f0f0; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #999; margin: 20px 0;">
            <div style="text-align: center;">
                <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“·</div>
                <p>ç”»åƒãŒã‚ã‚Šã¾ã›ã‚“</p>
            </div>
        </div>
    {% endif %}

    <!-- åº—èˆ—æƒ…å ± -->
    <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
        <h2 style="margin-bottom: 20px;">{{ shop.name }}</h2>
        <div style="background: #f9f9f9; padding: 20px; border-radius: 10px;">
            <p style="margin: 10px 0; display: flex; align-items: center;">
                <span style="font-weight: bold; min-width: 80px;">ğŸ“ ä½æ‰€:</span>
                <span>{{ shop.address }}</span>
            </p>
            <p style="margin: 10px 0; display: flex; align-items: center;">
                <span style="font-weight: bold; min-width: 80px;">ğŸ“ é›»è©±:</span>
                <span>{{ shop.phone_number }}</span>
            </p>
            <p style="margin: 10px 0; display: flex; align-items: center;">
                <span style="font-weight: bold; min-width: 80px;">ğŸª‘ å¸­æ•°:</span>
                <span>{{ shop.seat_count }}å¸­</span>
            </p>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
let currentSlideIndex = 0;
const totalSlides = {{ shop.images.count }};

function moveSlide(direction) {
    currentSlideIndex += direction;

    // æœ€åˆã¨æœ€å¾Œã®ç”»åƒã§ãƒ«ãƒ¼ãƒ—
    if (currentSlideIndex >= totalSlides) {
        currentSlideIndex = 0;
    } else if (currentSlideIndex < 0) {
        currentSlideIndex = totalSlides - 1;
    }

    updateCarousel();
}

function goToSlide(index) {
    currentSlideIndex = index;
    updateCarousel();
}

function updateCarousel() {
    const track = document.getElementById('carouselTrack');
    const translateX = -(currentSlideIndex * (100 / totalSlides));
    track.style.transform = `translateX(${translateX}%)`;

    // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®æ›´æ–°
    const indicators = document.querySelectorAll('.indicator-dot');
    indicators.forEach((dot, index) => {
        dot.style.background = index === currentSlideIndex ? 'white' : 'transparent';
    });

    // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®æ›´æ–°
    const counter = document.getElementById('currentSlide');
    if (counter) {
        counter.textContent = currentSlideIndex + 1;
    }
}

// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚µãƒãƒ¼ãƒˆ
document.addEventListener('keydown', function(e) {
    if (totalSlides > 1) {
        if (e.key === 'ArrowLeft') {
            moveSlide(-1);
        } else if (e.key === 'ArrowRight') {
            moveSlide(1);
        }
    }
});

// ã‚¿ãƒƒãƒã‚¹ãƒ¯ã‚¤ãƒ—ã‚µãƒãƒ¼ãƒˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰
let startX = 0;
let endX = 0;

document.querySelector('.carousel-container').addEventListener('touchstart', function(e) {
    startX = e.touches[0].clientX;
});

document.querySelector('.carousel-container').addEventListener('touchend', function(e) {
    endX = e.changedTouches[0].clientX;

    if (startX - endX > 50) {
        // å·¦ã«ã‚¹ãƒ¯ã‚¤ãƒ— = æ¬¡ã®ç”»åƒ
        moveSlide(1);
    } else if (endX - startX > 50) {
        // å³ã«ã‚¹ãƒ¯ã‚¤ãƒ— = å‰ã®ç”»åƒ
        moveSlide(-1);
    }
});
</script>

<!-- CSSï¼ˆãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼‰ -->
<style>
.carousel-btn:hover {
    background: rgba(0,0,0,0.7) !important;
    transform: translateY(-50%) scale(1.1);
}

.indicator-dot:hover {
    background: rgba(255,255,255,0.7) !important;
}

.image-carousel {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
</style>
{% endblock %}